## AI Energy Optimizer

An end-to-end demo that simulates retail energy usage, displays a live dashboard, and serves a simple backend API. It combines a Streamlit UI, a Flask backend, and a mock sensor feed. Optional notebooks/scripts can generate synthetic training data and a Random Forest model.

---

### Features
- **Live dashboard (Streamlit)**: Real-time weather, sensor readings, predicted usage, savings, and recommendations.
- **Backend API (Flask)**: Prediction and live sensor-state endpoints.
- **Mock sensor feed**: Posts occupancy and power draw every 5s.
- **Synthetic data**: Script to create `simulated_energy.csv` and train a baseline model.

---

### Project Structure
```text
AI-Energy Optimizer/
  backend/
    app.py                 # Flask API (predict + sensor state)
    data_simulation.py     # Generate synthetic data -> simulated_energy.csv
    preprocess.py          # Train/test split utilities
    train_model.py         # Train and save RF model -> models/rf_model.pkl
    models/
      rf_model.pkl         # (optional) Trained model artifact
  images/
    Walmart-Logo.png
  kpis.csv                 # (generated by dashboard download)
  simulated_energy.csv     # (generated by data_simulation.py)
  sensor_feed.py           # Mock sensor that posts to backend every 5s
  streamlit_app.py         # Streamlit dashboard
  requirements.txt
```

---

### Prerequisites
- Python 3.10+ (3.11 recommended)
- Windows PowerShell or a Unix-like shell
- Optional: OpenWeatherMap API key for live weather

---

### Quick Start (Windows PowerShell)
1) Clone/open the project and create a virtual environment.
```powershell
python -m venv .venv
.venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

2) (Optional) Generate synthetic data so charts have content.
```powershell
python backend\data_simulation.py
```
This should create `simulated_energy.csv` in the project root.

3) Set your OpenWeatherMap API key (optional but recommended).
```powershell
$env:OWM_API_KEY = "YOUR_OPENWEATHERMAP_KEY"
```
Alternatively for Streamlit, you can use secrets: create a `.streamlit\secrets.toml` file:
```toml
[weather]
OWM_API_KEY = "YOUR_OPENWEATHERMAP_KEY"
```

4) Start the backend API (Terminal 1):
```powershell
python backend\app.py
```
The API runs at `http://127.0.0.1:5000`.

5) Start the mock sensor feed (Terminal 2):
```powershell
python sensor_feed.py
```
This posts to `POST /sensor_update` every ~5 seconds.

6) Launch the dashboard (Terminal 3):
```powershell
streamlit run streamlit_app.py
```
Open the URL Streamlit prints (usually `http://localhost:8501`).

---

### How It Works
- The dashboard polls `GET /current_status` every 5 seconds to show current occupancy and power draw.
- A simple rule-based function estimates usage using hour, temperature, occupancy, and weekend flag. The dashboard displays predicted usage, estimated savings, and what-if controls.
- If `OWM_API_KEY` is set, live weather is fetched from OpenWeatherMap to influence recommendations.

---

### API Endpoints (Flask)
- `POST /predict`
  - Body (JSON):
    ```json
    {"hour": 14, "temperature": 30, "occupancy": 120, "is_weekend": 0}
    ```
  - Response: `{"predicted_usage_kW": 512.34}`

- `POST /sensor_update`
  - Body (JSON): `{"occupancy": 85, "power_kW": 455.2}`
  - Sets in-memory sensor state.

- `GET /current_status`
  - Response: `{"occupancy": 85, "power_kW": 455.2}`

---

### Optional: Train a Model
The dashboard uses a rule-based predictor and does not require ML, but you can train a baseline model with the synthetic data.

1) Ensure `simulated_energy.csv` exists (see Quick Start step 2).
```powershell
python backend\train_model.py
```
2) The model will be saved to `backend\models\rf_model.pkl`.

Note: The current Flask app uses the rule-based predictor for simplicity. You can wire the saved model into `backend\app.py` if you want model-backed predictions.

---

### Environment Variables
- `OWM_API_KEY`: OpenWeatherMap API key. Used by Streamlit for live weather.

---

### Troubleshooting
- Dashboard shows zero power/occupancy:
  - Ensure the backend is running on `127.0.0.1:5000`.
  - Ensure `sensor_feed.py` is running in another terminal and posting successfully.

- Weather not showing:
  - Set `OWM_API_KEY` or add it to Streamlit secrets. The app falls back to defaults if unavailable.

- `simulated_energy.csv` not found for charts:
  - Run `python backend\data_simulation.py` from the project root. This writes the CSV where `streamlit_app.py` expects it.

- Activate virtual environment on PowerShell:
  - Run `.venv\Scripts\Activate.ps1`. If blocked, set execution policy for the current session: `Set-ExecutionPolicy -Scope Process RemoteSigned`.

---

### Screenshots / Branding
You can add your own banner or use `images/Walmart-Logo.png` in your docs. The app UI supports dark and light themes with a selectable accent color.

---

### License
For internal demo/education. Add a license of your choice if distributing.


